<ng-container *ngIf="!test">
    <app-loader>
        Загружаем тест
    </app-loader>
</ng-container>

<ng-container *ngIf="test">
    <div class="test" @appear>
        <div class="test__wrapper">

            <div class="test__title-wrap">
                <div class="test__block">
                    <app-bread-crumbs
                            [crumbs]="crumbs">
                    </app-bread-crumbs>
                    <div class="test__title test-title">
                        <h1 class="test-title__item">
                            <span>
                                {{ test.name }}
                            </span>
                        </h1>
                        <div class="test-title__item">
                            <app-button (clickEvent)="fillTest()">редактировать</app-button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="test__columns">
                <div class="test__column">
                    <div class="test__block test__assessment test-assessment">

                        <h3 class="test-assessment__title">
                            <span>Оценивание</span>
                        </h3>

                        <ul class="test-assessment__list">
                            <ng-container *ngFor="let grad of assessment; let i = index">
                                <li class="test-assessment__grad-item">
                                    от
                                    &nbsp;
                                    <div class="test-assessment__justify">
                                    <span><ng-container *ngIf="i === assessment.length - 1">&nbsp;&nbsp;</ng-container>
                                        {{ grad.from }}%</span>
                                        <span>до</span>
                                        <span>{{ grad.to }}% <ng-container *ngIf="i !== 0">&nbsp;</ng-container></span>
                                    </div>
                                    &nbsp;
                                    — {{ grad.point }}
                                </li>
                            </ng-container>
                        </ul>

                    </div>
                </div>

                <div class="test__column">
                    <div class="test__stats">
                        <div class="stats-box">

                            <div class="stats-box__wrapper">
                                <div class="stats-box__container">
                                    <div class="stats-box__content">
                                        <div class="test__block stats-box__flex">
                                            <h2 class="stats-box__title">
                                                Средний балл
                                            </h2>
                                            <div class="stats-box__text">
                                                {{ test.stats.avgScore | number : ".0" }}%
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="stats-box__wrapper">
                                <div class="stats-box__container">
                                    <div class="stats-box__content">
                                        <div class="test__block stats-box__flex">
                                            <h2 class="stats-box__title">
                                                Самый сложный вопрос
                                            </h2>
                                            <div class="stats-box__text">
                                                №{{ test.stats.worstWork | number : ".0" }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="test__works">

                <h2 class="test__subtitle">
                    <span>Проверенные бланки</span>
                </h2>

                <div class="test__block">
                    <ul class="works__bar works-bar">
                        <li class="works-bar__item number">
                            Номер
                        </li>
                        <li class="works-bar__item name">
                            Фамилия Имя
                        </li>
                        <li class="works-bar__item score">
                            Балл
                        </li>
                        <li class="works-bar__item date">
                            Дата загрузки
                        </li>
                        <li class="works-bar__item delete">

                        </li>
                    </ul>

                    <ul class="works__list works-list">
                        <ng-container *ngFor="let work of test.blanks; let i = index">
                            <li class="works-list works-list__item">
                                <a href="#" (click)="showBlank($event, work.pk)" class="works-list__link">
                                    <span class="works-list__item number">
                                        {{ i + 1 }}
                                    </span>
                                    <span class="works-list__item name">
                                        <span>{{ work.authorInfo.name }}</span>
                                    </span>
                                    <span class="works-list__item score">
                                        {{ work.blankScore.percentage | number : ".0" }}
                                    </span>
                                    <span class="works-list__item date">
                                        {{ work.createdAt | date: "dd.MM.YYYY" }}
                                    </span>
                                    <span class="works-list__item delete">
                                        <a href="#" class="delete__button" (click)="deleteBlank($event, i)">
                                            <img src="assets/images/icons/deleteGrey.svg" alt="">
                                            <img src="assets/images/icons/delete.svg" alt="">
                                        </a>
                                    </span>
                                </a>
                            </li>
                        </ng-container>
                    </ul>
                    <div class="test__check">
                        <app-button
                                mode="filled"
                                (clickEvent)="navigateBlankButton()"
                        >
                            <ng-container *ngIf="showCheckButton; else fillVarsText">
                                проверить работу
                            </ng-container>
                            <ng-template #fillVarsText>
                                добавить варианты
                            </ng-template>
                        </app-button>
                    </div>

                </div>
            </div>

            <ng-container *ngIf="test.invalidBlanks.length > 0">
                <div class="test__works">
                    <h2 class="test__subtitle wrong">
                        <span>Несчитанные бланки</span>
                    </h2>

                    <div class="test__block">
                        <ul class="works__bar works-bar">
                            <li class="works-bar__item number">
                                Номер
                            </li>
                            <li class="works-bar__item name">
                                Фамилия Имя
                            </li>
                            <li class="works-bar__item date">
                                Дата загрузки
                            </li>
                            <li class="works-bar__item delete">

                            </li>
                        </ul>

                        <ul class="works__list works-list">
                            <ng-container *ngFor="let work of test.invalidBlanks; let i = index">
                                <li class="works-list works-list__item">
                                    <a href="#" (click)="showInvalidBlank($event, work.pk)" class="works-list__link">
                                        <span class="works-list__item number">
                                            {{ i + 1 }}
                                        </span>
                                        <span class="works-list__item name wrong">
                                            <span>Неизвестно</span>
                                        </span>
                                        <span class="works-list__item date">
                                            {{ work.createdAt | date: "dd.MM.YYYY" }}
                                        </span>
                                        <span class="works-list__item delete">
                                            <a href="#" class="delete__button" (click)="deleteInvalidBlank($event, i)">
                                                <img src="assets/images/icons/deleteGrey.svg" alt="">
                                                <img src="assets/images/icons/delete-red.svg" alt="">
                                            </a>
                                        </span>
                                    </a>
                                </li>
                            </ng-container>
                        </ul>

                    </div>
                </div>
            </ng-container>


            <div class="test__delete">
                <app-button
                        [mode]="'red'"
                        (clickEvent)="deleteTest()"
                >удалить тест
                </app-button>
            </div>

        </div>
    </div>
</ng-container>
